image: registry.gitlab.gnome.org/gnome/gnome-runtime-images/base:latest

build:
  script:
    - dnf install -y libappstream-glib-devel gettext
    - pip3 install fontmake psautohint meson ninja
    - meson build -Dfontsdir=prebuilt
    - ninja -C build install

    # Make a dist package with prebuilt binaries.
    - python3 scripts/flip-prebuilt-on.py meson_options.txt
    - git add meson_options.txt
    - cp /usr/local/prebuilt/*.otf prebuilt
    - git add prebuilt/*.otf
    - git commit -m "Make package with prebuilt binaries, ninja will dist them."
    - ninja -C build dist
  artifacts:
    paths:
      - build/meson-dist
    expire_in: 7 days